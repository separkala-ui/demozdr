# ุชุบุฑุงุช: ุงุถุงูู ุดุฏู ูุงุจูุช ุซุจุช ุฏูู ุจุฑุง "ุงุฑุณุงู ุจู ุจุงุฒุจู"

## ๐ ุฎูุงุตู ุชุบุฑุงุช

ุฏุฑ ูุณุฎู ูุจูุ ูุฏุฑ ูโุชูุงูุณุช ุชุฑุงฺฉูุด ุฑุง ุจุฑุง ุจุงุฒุจู ุงุฑุณุงู ฺฉูุฏ ุงูุง ููโุชูุงูุณุช ุฏูู ุฎูุฏ ุฑุง ุซุจุช ฺฉูุฏ. 
ุญุงูุง ูุดุงุจู **ุชุงุฏ** ู **ุฑุฏ**ุ ูุฏุฑ ูโุชูุงูุฏ ุฏูู ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู ุฑุง ุชูุถุญ ุฏูุฏ ุชุง ฺฉุงุฑุจุฑ ุดุนุจู ุจุฏุงูุฏ ฺู ุชุบุฑุงุช ูุงุฒู ุงุณุช.

---

## ๐ฏ ูฺฺฏโูุง ุฌุฏุฏ

### 1. Modal ุฌุฏุฏ ุจุฑุง ุซุจุช ุฏูู ุจุงุฒุจู
- โ Modal ุฒุจุง ุจุง ุทุฑุงุญ ูุดุงุจู modal ูุง ุชุงุฏ ู ุฑุฏ
- โ ููุฏ ุงูุฒุงู ุจุฑุง ูุงุฑุฏ ฺฉุฑุฏู ุฏูู (ุญุฏุงูู 5 ฺฉุงุฑุงฺฉุชุฑ)
- โ ููุงุด ุงุทูุงุนุงุช ุชุฑุงฺฉูุด ุฏุฑ modal
- โ ูพุงู ุฑุงูููุง ุจุฑุง ฺฉุงุฑุจุฑ

### 2. Validation ฺฉุงูู
- โ ุจุฑุฑุณ ุญุฏุงูู ุทูู (5 ฺฉุงุฑุงฺฉุชุฑ)
- โ ุจุฑุฑุณ ุญุฏุงฺฉุซุฑ ุทูู (500 ฺฉุงุฑุงฺฉุชุฑ)
- โ ูพุงูโูุง ุฎุทุง ูุงุฑุณ
- โ ููุงุด ุฎุทุง ุฏุฑ UI

### 3. ุฐุฎุฑูโุณุงุฒ ุฏูู
- โ ุฐุฎุฑู ุฏุฑ `meta->revision_note`
- โ ุซุจุช ุชุงุฑุฎ ู ฺฉุงุฑุจุฑ ุฏุฑุฎูุงุณุชโฺฉููุฏู
- โ ููุงุด ุฏูู ุจุฑุง ฺฉุงุฑุจุฑ ุดุนุจู

---

## ๐ ูุงูโูุง ุชุบุฑ ุงูุชู

### 1. Backend - Livewire Component
**ูุงู:** `app/Livewire/PettyCash/TransactionsTable.php`

#### ุชุบุฑุงุช:
```php
// Property ูุง ุฌุฏุฏ
public bool $showRevisionModal = false;
public ?int $revisionTransactionId = null;
public string $revisionNote = '';

// ูุชุฏ ุฌุฏุฏ ุจุฑุง ุจุงุฒ ฺฉุฑุฏู modal
public function openRevisionModal(int $transactionId): void

// ูุชุฏ ุจุงุฒููุณ ุดุฏู ุจุง validation
public function requestRevision(): void
```

**ุฎุทูุท ุชุบุฑ ุงูุชู:**
- ุฎุท 57-61: ุงุถุงูู ุดุฏู property ูุง ุฌุฏุฏ
- ุฎุท 161-170: ูุชุฏ `openRevisionModal()`
- ุฎุท 172-213: ูุชุฏ `requestRevision()` ุจุงุฒููุณ ุดุฏู

### 2. Backend - Service Layer
**ูุงู:** `app/Services/PettyCash/PettyCashService.php`

#### ุชุบุฑุงุช:
```php
public function sendBackForRevision(
    PettyCashTransaction $transaction, 
    User $manager, 
    ?string $note = null
): PettyCashTransaction
{
    // ุงุถุงูู ุดุฏู validation
    $note = trim((string) $note);
    
    if ($note === '') {
        throw ValidationException::withMessages([
            'revisionNote' => __('ูุทูุงู ุฏูู ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู ุฑุง ูุงุฑุฏ ฺฉูุฏ.'),
        ]);
    }
    
    // ... ุจูู ฺฉุฏ
}
```

**ุฎุทูุท ุชุบุฑ ุงูุชู:**
- ุฎุท 121-151: ุงุถุงูู ุดุฏู validation ุจู ูุชุฏ `sendBackForRevision()`

### 3. Frontend - Blade View
**ูุงู:** `resources/views/livewire/petty-cash/transactions-table.blade.php`

#### ุชุบุฑุงุช:
1. **ุฏฺฉูู ุงุฑุณุงู ุจู ุจุงุฒุจู** (2 ููุฑุฏ):
```blade
// ูุจู:
wire:click="requestRevision({{ $transaction->id }})"

// ุจุนุฏ:
wire:click="openRevisionModal({{ $transaction->id }})"
```

2. **Modal ุฌุฏุฏ** (ุฎุท 867-942):
```blade
<!-- Revision Modal -->
<div class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60"
     x-data="{ show: @entangle('showRevisionModal') }"
     x-show="show">
    <!-- ูุญุชูุง modal -->
</div>
```

**ุฎุทูุท ุชุบุฑ ุงูุชู:**
- ุฎุท 285: ุชุบุฑ ุงุฒ `requestRevision()` ุจู `openRevisionModal()`
- ุฎุท 455: ุชุบุฑ ุงุฒ `requestRevision()` ุจู `openRevisionModal()`
- ุฎุท 867-942: ุงุถุงูู ุดุฏู Modal ฺฉุงูู ุจุฑุง revision

---

## ๐จ UI/UX ุจูุจูุฏูุง

### Modal Design
- **ุฑูฺฏโุจูุฏ:** ุฑูฺฏ amber ุจุฑุง ููุงููฺฏ ุจุง ุฏฺฉูู "ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู"
- **Icon:** ุงุณุชูุงุฏู ุงุฒ `lucide:arrow-left-right`
- **Layout:** ูุดุงุจู modal ูุง ุชุงุฏ ู ุฑุฏ ุจุฑุง ฺฉูพุงุฑฺฺฏ UI

### ููุงุด ุงุทูุงุนุงุช
- ุดูุงุฑู ูุฑุฌุน ุชุฑุงฺฉูุด
- ูุจูุบ ุชุฑุงฺฉูุด
- ุดุฑุญ ุชุฑุงฺฉูุด
- ููุฏ textarea ุจุฑุง ุฏูู

### ูพุงูโูุง
- ุฑุงูููุง ูุงุถุญ ุฏุฑ ุจุงูุง modal
- placeholder ููุฏ ุฏุฑ textarea
- ูพุงู ฺฉูฺฉ ุฒุฑ textarea
- ูพุงูโูุง ุฎุทุง ูุงุถุญ

---

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุจุฑุง ูุฏุฑ:

1. **ุจุงุฒ ฺฉุฑุฏู ูุณุช ุชุฑุงฺฉูุดโูุง**
   - ูุฑูุฏ ุจู ูพูู โ ุชูุฎูุงู โ ุงูุชุฎุงุจ ุฏูุชุฑ โ ุชุฑุงฺฉูุดโูุง

2. **ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู**
   - ฺฉูฺฉ ุฑู ุฏฺฉูู "ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู" ุฏุฑ ฺฉูุงุฑ ุชุฑุงฺฉูุด ููุฑุฏ ูุธุฑ
   - modal ุจุงุฒ ูโุดูุฏ

3. **ูุงุฑุฏ ฺฉุฑุฏู ุฏูู**
   - ุฏูู ุฑุง ุชูุถุญ ุฏูุฏ (ูุซูุงู: "ูุทูุงู ูุงฺฉุชูุฑ ุงุตู ุฑุง ุขูพููุฏ ฺฉูุฏ")
   - ุญุฏุงูู 5 ฺฉุงุฑุงฺฉุชุฑ ุงูุฒุงู ุงุณุช
   - ฺฉูฺฉ ุฑู "ุงุฑุณุงู ุจู ุจุงุฒุจู"

4. **ูุชุฌู**
   - ูุถุนุช ุชุฑุงฺฉูุด ุจู "ูุงุฒ ุจู ุชุบุฑุงุช" ุชุบุฑ ูโฺฉูุฏ
   - ฺฉุงุฑุจุฑ ุดุนุจู ุฏูู ุฑุง ูุดุงูุฏู ูโฺฉูุฏ
   - ุฏูู ุฏุฑ ูุชุงุฏุชุง ุชุฑุงฺฉูุด ุฐุฎุฑู ูโุดูุฏ

### ุจุฑุง ฺฉุงุฑุจุฑ ุดุนุจู:

1. ุชุฑุงฺฉูุด ุฏุฑ ูุถุนุช "ูุงุฒ ุจู ุชุบุฑุงุช" ูุฑุงุฑ ูโฺฏุฑุฏ
2. ุฏูู ูุฏุฑ ุฑุง ูุดุงูุฏู ูโฺฉูุฏ
3. ุชุบุฑุงุช ูุงุฒู ุฑุง ุงุนูุงู ูโฺฉูุฏ
4. ุชุฑุงฺฉูุด ุฑุง ูุฌุฏุฏ ุงุฑุณุงู ูโฺฉูุฏ

---

## โ Validation Rules

| ููุฏ | ูุงููู | ูพุงู ุฎุทุง |
|------|-------|----------|
| `revisionNote` | required | ูุทูุงู ุฏูู ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู ุฑุง ูุงุฑุฏ ฺฉูุฏ. |
| `revisionNote` | min:5 | ุฏูู ุจุงุฏ ุญุฏุงูู ต ฺฉุงุฑุงฺฉุชุฑ ุจุงุดุฏ. |
| `revisionNote` | max:500 | ุฏูู ูุจุงุฏ ุจุดุชุฑ ุงุฒ ตฐฐ ฺฉุงุฑุงฺฉุชุฑ ุจุงุดุฏ. |

---

## ๐ ุณุงุฎุชุงุฑ ุฏุงุฏู

### ุฐุฎุฑู ุฏุฑ ุฏุชุงุจุณ

ุฏูู ุจุงุฒุจู ุฏุฑ ููุฏ `meta` ุฌุฏูู `petty_cash_transactions` ุฐุฎุฑู ูโุดูุฏ:

```json
{
  "revision_requested_by": 1,
  "revision_requested_at": "2025-10-26T19:30:00.000Z",
  "revision_note": "ูุทูุงู ูุงฺฉุชูุฑ ุงุตู ุฑุง ุขูพููุฏ ฺฉูุฏ",
  "approval_note": null,
  "rejection_reason": null
}
```

---

## ๐งช ุชุณุช

### ุชุณุช ุฏุณุช

1. โ ุจุงุฒ ุดุฏู modal
2. โ ุจุณุชู modal ุจุง ุฏฺฉูู ุงูุตุฑุงู
3. โ ุจุณุชู modal ุจุง ESC
4. โ ุจุณุชู modal ุจุง ฺฉูฺฉ ุจุฑูู
5. โ ููุงุด ุฎุทุง ุจุฑุง ููุฏ ุฎุงู
6. โ ููุงุด ุฎุทุง ุจุฑุง ูุชู ฺฉูุชุงู (< 5 ฺฉุงุฑุงฺฉุชุฑ)
7. โ ุฐุฎุฑู ูููู ุจุง ุฏูู ูุนุชุจุฑ
8. โ ููุงุด ูพุงู ููููุช
9. โ refresh ุดุฏู ูุณุช ุชุฑุงฺฉูุดโูุง
10. โ ุชุบุฑ ูุถุนุช ุจู "ูุงุฒ ุจู ุชุบุฑุงุช"

### ุณูุงุฑููุง ุชุณุช

#### ุณูุงุฑู 1: ุงุฑุณุงู ูููู
```
1. ฺฉูฺฉ ุฑู "ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู"
2. ูุงุฑุฏ ฺฉุฑุฏู ุฏูู: "ูุทูุงู ูุงฺฉุชูุฑ ุงุตู ุฑุง ุขูพููุฏ ฺฉูุฏ"
3. ฺฉูฺฉ ุฑู "ุงุฑุณุงู ุจู ุจุงุฒุจู"
4. ุงูุชุธุงุฑ: ูพุงู ููููุช + ุจุณุชู modal + ุชุบุฑ ูุถุนุช
```

#### ุณูุงุฑู 2: ุฎุทุง validation
```
1. ฺฉูฺฉ ุฑู "ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู"
2. ูุงุฑุฏ ฺฉุฑุฏู ูุชู ฺฉูุชุงู: "ok"
3. ฺฉูฺฉ ุฑู "ุงุฑุณุงู ุจู ุจุงุฒุจู"
4. ุงูุชุธุงุฑ: ูพุงู ุฎุทุง "ุฏูู ุจุงุฏ ุญุฏุงูู ต ฺฉุงุฑุงฺฉุชุฑ ุจุงุดุฏ."
```

#### ุณูุงุฑู 3: ุงูุตุฑุงู
```
1. ฺฉูฺฉ ุฑู "ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู"
2. ูุงุฑุฏ ฺฉุฑุฏู ุฏูู
3. ฺฉูฺฉ ุฑู "ุงูุตุฑุงู"
4. ุงูุชุธุงุฑ: ุจุณุชู modal ุจุฏูู ุชุบุฑ
```

---

## ๐ ููุงุณู ูุจู ู ุจุนุฏ

### โ ูุจู (ุจุฏูู modal)
```php
// ฺฉูฺฉ ูุณุชูู
wire:click="requestRevision({{ $transaction->id }})"

// ุจุฏูู ูุฑูุฏ ุงุฒ ฺฉุงุฑุจุฑ
app(PettyCashService::class)->sendBackForRevision($transaction, Auth::user());
```

### โ ุจุนุฏ (ุจุง modal ู ุฏูู)
```php
// ฺฉูฺฉ ุจุฑุง ุจุงุฒ ฺฉุฑุฏู modal
wire:click="openRevisionModal({{ $transaction->id }})"

// ุจุง ูุฑูุฏ ุฏูู ุงุฒ ฺฉุงุฑุจุฑ
app(PettyCashService::class)->sendBackForRevision($transaction, Auth::user(), $this->revisionNote);
```

---

## ๐ฆ ุณุงุฒฺฏุงุฑ

- โ Laravel 12.x
- โ Livewire 3.x
- โ PHP 8.3+
- โ Tailwind CSS 4.x
- โ Alpine.js 3.x

---

## ๐ ูุณุงุฆู ุดูุงุฎุชู ุดุฏู

ูฺ ูุดฺฉู ุดูุงุณุง ูุดุฏู ุงุณุช.

---

## ๐ฏ ฺฉุงุฑูุง ุขูุฏู

- [ ] ุงูุฒูุฏู ุงูฺฉุงู ูุฑุงุด ุฏูู ุจุงุฒุจู
- [ ] ุซุจุช ุชุงุฑุฎฺู ุชุบุฑุงุช ุฏูู
- [ ] ุงุนูุงู ุจู ฺฉุงุฑุจุฑ ุดุนุจู ููฺฏุงู ุงุฑุณุงู ุจุฑุง ุจุงุฒุจู
- [ ] ููุงุด ุฏูู ุฏุฑ ุตูุญู ุฌุฒุฆุงุช ุชุฑุงฺฉูุด

---

## ๐ฅ ูุดุงุฑฺฉุชโฺฉููุฏฺฏุงู

- ุชุบุฑุงุช ุชูุณุท: AI Assistant (Claude)
- ุฏุฑุฎูุงุณุช ุชูุณุท: ฺฉุงุฑุจุฑ ูพุฑูฺู ZDR
- ุชุงุฑุฎ: 26 ุขุจุงู 1404

---

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
- ๐ง Email: support@zdr.ir
- ๐ฌ GitHub Issues: https://github.com/separkala-ui/zdr/issues

---

**ูุณุฎู:** 2.3.1  
**ุชุงุฑุฎ:** 26 ุขุจุงู 1404  
**ูุถุนุช:** โ ุชฺฉูู ุดุฏู ู ุขูุงุฏู ุงุณุชูุงุฏู

